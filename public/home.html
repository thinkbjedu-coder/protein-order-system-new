<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ãƒ›ãƒ¼ãƒ  - ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³æ³¨æ–‡ã‚·ã‚¹ãƒ†ãƒ </title>
    <link rel="stylesheet" href="/css/variables.css">
    <link rel="stylesheet" href="/css/common.css">
    <link rel="stylesheet" href="/css/components.css">
</head>

<body>
    <div class="app-container">
        <!-- ã‚µã‚¤ãƒ‰ãƒãƒ¼ -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <a href="/home.html" class="sidebar-logo">Think Body Japan</a>
            </div>

            <nav class="sidebar-nav">
                <a href="/home.html" class="nav-item active">
                    <span class="nav-item-icon">ğŸ </span>
                    ãƒ›ãƒ¼ãƒ 
                </a>
                <a href="/order.html" class="nav-item">
                    <span class="nav-item-icon">ğŸ›’</span>
                    æ–°è¦æ³¨æ–‡
                </a>
                <a href="/history.html" class="nav-item">
                    <span class="nav-item-icon">ğŸ“‹</span>
                    æ³¨æ–‡å±¥æ­´
                </a>
                <a href="/profile.html" class="nav-item">
                    <span class="nav-item-icon">ğŸ‘¤</span>
                    ä¼šå“¡æƒ…å ±
                </a>
                <a href="/shipping.html" class="nav-item">
                    <span class="nav-item-icon">ğŸ“¦</span>
                    é…é€å…ˆç®¡ç†
                </a>
                <a href="/contact.html" class="nav-item">
                    <span class="nav-item-icon">ğŸ’¬</span>
                    ãŠå•ã„åˆã‚ã›
                </a>
            </nav>

            <div class="sidebar-footer">
                <button onclick="logout()" class="btn btn-outline btn-block">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
            </div>
        </aside>

        <!-- ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ -->
        <main class="main-content">
            <header class="header">
                <h1 class="header-title">ãƒ›ãƒ¼ãƒ </h1>
                <div class="header-actions">
                    <span id="user-name"></span>
                </div>
            </header>

            <div class="content">
                <div id="alert-container"></div>

                <!-- ã‚¦ã‚§ãƒ«ã‚«ãƒ ã‚«ãƒ¼ãƒ‰ -->
                <div class="card mb-xl">
                    <div class="card-body">
                        <h2 style="font-size: var(--font-size-2xl); margin-bottom: var(--spacing-md);">
                            ã‚ˆã†ã“ãã€<span id="company-name"></span>æ§˜
                        </h2>
                    </div>
                </div>

                <!-- ã‚¯ã‚¤ãƒƒã‚¯ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ -->
                <div
                    style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-lg); margin-bottom: var(--spacing-xl);">
                    <a href="/order.html" class="card" style="text-decoration: none; color: inherit;">
                        <div class="card-body">
                            <div style="font-size: 3rem; margin-bottom: var(--spacing-md);">ğŸ›’</div>
                            <h3 style="font-size: var(--font-size-xl); margin-bottom: var(--spacing-sm);">æ–°è¦æ³¨æ–‡</h3>
                            <p style="color: var(--color-text-secondary); font-size: var(--font-size-sm);">
                                ãƒ—ãƒ­ãƒ†ã‚¤ãƒ³ã‚’æ³¨æ–‡ã™ã‚‹
                            </p>
                        </div>
                    </a>

                    <a href="/history.html" class="card" style="text-decoration: none; color: inherit;">
                        <div class="card-body">
                            <div style="font-size: 3rem; margin-bottom: var(--spacing-md);">ğŸ“‹</div>
                            <h3 style="font-size: var(--font-size-xl); margin-bottom: var(--spacing-sm);">æ³¨æ–‡å±¥æ­´</h3>
                            <p style="color: var(--color-text-secondary); font-size: var(--font-size-sm);">
                                éå»ã®æ³¨æ–‡ã‚’ç¢ºèªã™ã‚‹
                            </p>
                        </div>
                    </a>

                    <a href="/shipping.html" class="card" style="text-decoration: none; color: inherit;">
                        <div class="card-body">
                            <div style="font-size: 3rem; margin-bottom: var(--spacing-md);">ğŸ“¦</div>
                            <h3 style="font-size: var(--font-size-xl); margin-bottom: var(--spacing-sm);">é…é€å…ˆç®¡ç†</h3>
                            <p style="color: var(--color-text-secondary); font-size: var(--font-size-sm);">
                                é…é€å…ˆã‚’ç™»éŒ²ãƒ»ç·¨é›†ã™ã‚‹
                            </p>
                        </div>
                    </a>
                </div>

                <!-- æœ€è¿‘ã®æ³¨æ–‡ -->
                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">æœ€è¿‘ã®æ³¨æ–‡</h3>
                    </div>
                    <div class="card-body">
                        <div id="recent-orders"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script src="/js/utils.js"></script>
    <script>
        // ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±å–å¾—
        async function loadUserInfo() {
            try {
                const user = await apiRequest('/api/me');
                document.getElementById('user-name').textContent = `${user.last_name} ${user.first_name}`;
                document.getElementById('company-name').textContent = user.company_name;
            } catch (error) {
                console.error('User info error:', error);
            }
        }

        // æœ€è¿‘ã®æ³¨æ–‡å–å¾—
        async function loadRecentOrders() {
            try {
                const orders = await apiRequest('/api/orders');
                const container = document.getElementById('recent-orders');

                if (orders.length === 0) {
                    container.innerHTML = `
            <div class="empty-state">
              <div class="empty-state-icon">ğŸ“¦</div>
              <h3 class="empty-state-title">æ³¨æ–‡å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</h3>
              <p class="empty-state-description">ã¾ã æ³¨æ–‡ãŒã‚ã‚Šã¾ã›ã‚“ã€‚æ–°è¦æ³¨æ–‡ã‹ã‚‰å•†å“ã‚’æ³¨æ–‡ã—ã¦ãã ã•ã„ã€‚</p>
              <a href="/order.html" class="btn btn-primary">æ–°è¦æ³¨æ–‡</a>
            </div>
          `;
                    return;
                }

                const recentOrders = orders.slice(0, 5);
                const html = `
          <div class="table-container">
            <table class="table">
              <thead>
                <tr>
                  <th>æ³¨æ–‡ID</th>
                  <th>æ•°é‡</th>
                  <th>åˆè¨ˆé‡‘é¡</th>
                  <th>ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹</th>
                  <th>æ³¨æ–‡æ—¥æ™‚</th>
                </tr>
              </thead>
              <tbody>
                ${recentOrders.map(order => `
                  <tr>
                    <td>#${order.id}</td>
                    <td>${order.quantity}è¢‹</td>
                    <td>${formatPrice(order.total_price)}</td>
                    <td>${getStatusBadge(order.status)}</td>
                    <td>${formatDate(order.created_at)}</td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </div>
          <div style="margin-top: var(--spacing-md); text-align: center;">
            <a href="/history.html" class="btn btn-outline">ã™ã¹ã¦ã®æ³¨æ–‡ã‚’è¦‹ã‚‹</a>
          </div>
        `;

                container.innerHTML = html;
            } catch (error) {
                console.error('Orders error:', error);
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚
        loadUserInfo();
        loadRecentOrders();
    </script>
</body>

</html>